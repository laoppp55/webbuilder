/*
 * JSP generated by Resin-4.0.58 (built Fri, 24 Aug 2018 01:23:14 PDT)
 */

package _jsp._column;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import java.util.*;
import com.bizwink.cms.news.*;
import com.bizwink.cms.extendAttr.*;
import com.bizwink.cms.security.*;
import org.jdom.*;
import com.bizwink.cms.util.*;
import org.jdom.input.*;
import java.io.*;
import com.bizwink.util.JSON_Str_To_ObjArray;
import com.bizwink.util.zTreeNodeObj;
import net.sf.json.JSONObject;
import net.sf.json.JSONArray;

public class _editattr__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;
  private boolean _caucho_isNotModified;
  private com.caucho.jsp.PageManager _jsp_pageManager;
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    com.caucho.jsp.PageContextImpl pageContext = _jsp_pageManager.allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);

    TagState _jsp_state = null;

    try {
      _jspService(request, response, pageContext, _jsp_application, session, _jsp_state);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_pageManager.freePageContext(pageContext);
    }
  }
  
  private void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response,
              com.caucho.jsp.PageContextImpl pageContext,
              javax.servlet.ServletContext application,
              javax.servlet.http.HttpSession session,
              TagState _jsp_state)
    throws Throwable
  {
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    javax.servlet.jsp.tagext.JspTag _jsp_parent_tag = null;
    com.caucho.jsp.PageContextImpl _jsp_parentContext = pageContext;
    response.setContentType("text/html;charset=gbk");

    out.write(_jsp_string0, 0, _jsp_string0.length);
    
    Auth authToken = SessionUtil.getUserAuthorization(request,response,session);
    if (authToken == null) {
        response.sendRedirect(response.encodeRedirectURL("../login.jsp?msg=\u7cfb\u7edf\u8d85\u65f6\uff0c\u8bf7\u91cd\u65b0\u767b\u9646!"));
        return;
    }

    String errormsg = "";
    String defaultval = "";
    boolean error = false;
    int siteid = authToken.getSiteID();
    int columnID = ParamUtil.getIntParameter(request, "ID", 0);
    int from = ParamUtil.getIntParameter(request, "from", 0);   //from=1\u6765\u81ea\u9996\u9875
    String act = ParamUtil.getParameter(request, "act");
    boolean extattrscope = ParamUtil.getCheckboxParameter(request, "attrscope");
    IColumnManager columnMgr = ColumnPeer.getInstance();
    if (from == 1) {
        Column rootColumn = columnMgr.getRootparentColumn(siteid);
        columnID = rootColumn.getID();
    }

    if (act == null){
        session.removeAttribute("ExtendAttr");
        if (columnID > 0){
            String xmlTemplate = columnMgr.getColumn(columnID).getXMLTemplate();
            if (xmlTemplate != null && xmlTemplate.trim().length() > 0){
                xmlTemplate = StringUtil.gb2iso4View(xmlTemplate);
                SAXBuilder builder = new SAXBuilder();
                Reader in = new StringReader(xmlTemplate);
                Document doc = builder.build(in);

                List attrList = new ArrayList();
                List nodeList = doc.getRootElement().getChildren();

                for (int i=0; i<nodeList.size(); i++){
                    Element e = (Element)nodeList.get(i);
                    ExtendAttr extend = new ExtendAttr();
                    extend.setCName(e.getText());
                    extend.setEName(e.getName());
                    defaultval = e.getAttributeValue("defaultval");
                    int type = Integer.parseInt(e.getAttributeValue("type"));
                    int datatype = Integer.parseInt(e.getAttributeValue("datatype"));
                    if (defaultval!=null && defaultval.indexOf("null")==-1) {
                        if (type == 5) {                   //\u4e0b\u62c9\u5217\u8868\u7c7b\u578b
                            extend.setDefaultValue(defaultval);
                        } else {                           //\u5176\u4ed6\u7c7b\u578b
                            defaultval = defaultval.replace(" ","\r\n");
                            extend.setDefaultValue(defaultval);
                        }
                    } else {
                        extend.setDefaultValue("");
                    }
                    extend.setControlType(type);
                    extend.setDataType(datatype);
                    attrList.add(extend);
                }
                session.setAttribute("ExtendAttr", attrList);
            }
        }
    }

    //\u589e\u52a0
    if (act != null && act.equals("doCreate")){
        int width = 0;
        int height = 0;
        List<String> typeOptions = null;             //\u5206\u7c7b\u6570\u636e\u6309\u7167\u5c42\u6b21\u7ed3\u6784\u7ec4\u7ec7\u7684\u4e0b\u62c9\u5217\u8868\u9009\u9879\u96c6\u5408
        String typeinfos = null;                          //\u7528\u4e8e\u4fdd\u5b58\u5b58\u50a8\u5728\u9690\u542b\u5b57\u6bb5droplist0\u4e2d\u7684\u503c

        String cname = ParamUtil.getParameter(request, "cname");
        String ename = ParamUtil.getParameter(request, "ename");
        String defaultValue = ParamUtil.getParameter(request, "defaultval");
        int type = ParamUtil.getIntParameter(request, "type", 0);
        int datatype = ParamUtil.getIntParameter(request, "datatype", 0);
        if (type == 3){
            width = ParamUtil.getIntParameter(request, "width", 0);
            height = ParamUtil.getIntParameter(request, "height", 0);
        }
        if (type == 5) {
            defaultValue = ParamUtil.getParameter(request,"droplist");
        }

        if (cname == null || cname.trim().length() == 0 || ename == null || ename.trim().length() == 0 || type == 0 || datatype == 0){
            error = true;
            errormsg = "<p align=center><font color=red><b>\u521b\u5efa\u6269\u5c55\u5c5e\u6027\u51fa\u9519\uff01</b></font></p>";
        }

        if (!error){
            ename = "_" + ename;
            List attrList = (List)session.getAttribute("ExtendAttr");
            if (attrList != null) {
                for (int i=0; i<attrList.size(); i++) {
                    ExtendAttr extend = (ExtendAttr)attrList.get(i);
                    if (ename.equalsIgnoreCase(extend.getEName())) {
                        error = true;
                        errormsg = "<p align=center><font color=red><b>\u6269\u5c55\u5c5e\u6027\u82f1\u6587\u540d\u79f0\u91cd\u590d\uff01</b></font></p>";
                        break;
                    }
                }
            } else {
                attrList = new ArrayList();
            }

            if (!error) {
                ExtendAttr extend = new ExtendAttr();
                extend.setCName(cname);
                extend.setEName(ename);
                extend.setDefaultValue(defaultValue);
                extend.setDataType(datatype);
                extend.setControlType(type);
                extend.setPicWidth(width);
                extend.setPicHeight(height);
                attrList.add(extend);
                session.setAttribute("ExtendAttr", attrList);
            }
        }
        response.sendRedirect("editattr.jsp?act=doNothing&from="+from+"&ID="+columnID);
    }

    //\u5220\u9664
    if (act != null && act.equals("doDelete")){
        String ename = ParamUtil.getParameter(request, "ename");
        List attrList = (List)session.getAttribute("ExtendAttr");
        if (attrList != null){
            for (int i=0; i<attrList.size(); i++){
                ExtendAttr extend = (ExtendAttr)attrList.get(i);
                if (ename.equalsIgnoreCase(extend.getEName())){
                    attrList.remove(i);
                    break;
                }
            }
            session.setAttribute("ExtendAttr", attrList);
        }
        response.sendRedirect("editattr.jsp?act=doNothing&from="+from+"&ID="+columnID);
    }

    //\u4fee\u6539
    if (act != null && act.equals("doUpdate")){
        int width = 0;
        int height = 0;
        List<String> typeOptions = null;             //\u5206\u7c7b\u6570\u636e\u6309\u7167\u5c42\u6b21\u7ed3\u6784\u7ec4\u7ec7\u7684\u4e0b\u62c9\u5217\u8868\u9009\u9879\u96c6\u5408
        String typeinfos = null;                          //\u7528\u4e8e\u4fdd\u5b58\u5b58\u50a8\u5728\u9690\u542b\u5b57\u6bb5droplist0\u4e2d\u7684\u503c
        String defaultValue = null;
        String ename = ParamUtil.getParameter(request, "ename");
        String cname = ParamUtil.getParameter(request, "cname");

        int type = ParamUtil.getIntParameter(request, "type", 0);
        int datatype = ParamUtil.getIntParameter(request, "datatype", 0);
        if (cname == null || cname.trim().length() == 0 || ename == null || ename.trim().length() == 0 || type == 0){
            error = true;
            errormsg = "<p align=center><font color=red><b>\u4fee\u6539\u6269\u5c55\u5c5e\u6027\u51fa\u9519\uff01</b></font></p>";
        }

        if (type == 3){
            width = ParamUtil.getIntParameter(request, "width", 0);
            height = ParamUtil.getIntParameter(request, "height", 0);
        }

        if (type == 5) {
            int rowno = ParamUtil.getIntParameter(request,"rowno",0);
            defaultValue = ParamUtil.getParameter(request,"droplist"+rowno);
        }

        if (!error){
            List attrList = (List)session.getAttribute("ExtendAttr");
            for (int i=0; i<attrList.size(); i++){
                ExtendAttr extend = (ExtendAttr)attrList.get(i);
                if (ename.equalsIgnoreCase(extend.getEName())){
                    extend.setCName(cname);
                    extend.setControlType(type);
                    if (type == 5) extend.setDefaultValue(defaultValue);
                    extend.setDataType(datatype);
                    attrList.set(i, extend);
                    break;
                }
            }
            session.setAttribute("ExtendAttr", attrList);
        }
        response.sendRedirect("editattr.jsp?act=doNothing&from="+from+"&ID="+columnID);
    }

    //\u4fdd\u5b58\u5e76\u5173\u95ed\u7a97\u53e3
    if (act != null && act.equals("doSave")){
        List attrList = (List)session.getAttribute("ExtendAttr");
        String retstr = "";

        if (attrList != null){
            for (int i=0; i<attrList.size(); i++){
                ExtendAttr extend = (ExtendAttr)attrList.get(i);
                defaultval = (extend.getDefaultValue()==null?"":extend.getDefaultValue());
                if (extend.getControlType() == 3)
                    retstr = retstr + "<" + extend.getEName() + " datatype=\"" + extend.getDataType() + "\" type=\"" + extend.getControlType() + "\"" + " defaultval=\"" + defaultval + "\" width=\"" + extend.getPicWidth() + "\" height=\"" + extend.getPicHeight() + "\">" + extend.getCName() + "</" + extend.getEName() + ">";
                else if (extend.getControlType() == 5){
                    String options_val = ParamUtil.getParameter(request, "droplist" + i);
                    retstr = retstr + "<" + extend.getEName() + " datatype=\"" + extend.getDataType() + "\" type=\"" + extend.getControlType() + "\"" + " defaultval=\"" + options_val + "\">" + extend.getCName() + "</" + extend.getEName() + ">";
                }else
                    retstr = retstr + "<" + extend.getEName() + " datatype=\"" + extend.getDataType() + "\" type=\"" + extend.getControlType() + "\"" + " defaultval=\"" + defaultval + "\">" + extend.getCName() + "</" + extend.getEName() + ">";
            }
        }

        if (retstr.trim().length() > 0) retstr = "<?xml version=\"1.0\" encoding=\"GB2312\"?><Article_Properties>" + retstr + "</Article_Properties>";

        Column column = new Column();
        column.setDefineAttr(1);
        column.setSiteID(siteid);
        column.setXMLTemplate(retstr);
        column.setID(columnID);
        if (extattrscope)
            column.setExtattrscope(1);
        else
            column.setExtattrscope(0);
        columnMgr.updateColumnExtendAttr(column);

        retstr = retstr.replace("\r\n"," ");

        if (from == 1){
            out.println("<script language=javascript>window.close();</script>");
        } else {
            retstr = retstr.replaceAll("'","&apos;");
            out.println("<script language=javascript>opener.updateForm.xmlTemplate.value='"+retstr+"';opener.updateForm.extattrscope.value='" + extattrscope + "';window.close();</script>");
        }
        session.removeAttribute("ExtendAttr");
        return;
    }

    out.write(_jsp_string1, 0, _jsp_string1.length);
    out.print((from));
    out.write(_jsp_string2, 0, _jsp_string2.length);
    out.print((columnID));
    out.write(_jsp_string3, 0, _jsp_string3.length);
    out.print((from));
    out.write(_jsp_string4, 0, _jsp_string4.length);
    out.print((columnID));
    out.write(_jsp_string5, 0, _jsp_string5.length);
    out.print((columnID));
    out.write(_jsp_string6, 0, _jsp_string6.length);
    out.print((from));
    out.write(_jsp_string2, 0, _jsp_string2.length);
    out.print((columnID));
    out.write(_jsp_string7, 0, _jsp_string7.length);
    out.print((errormsg));
    out.write(_jsp_string8, 0, _jsp_string8.length);
    
                        List attrList = (List)session.getAttribute("ExtendAttr");
                        if (attrList != null){
                            for (int i=0; i<attrList.size(); i++){
                                ExtendAttr extend = (ExtendAttr)attrList.get(i);
                                int controlType = extend.getControlType();
                                int dataType = extend.getDataType();
                    
    out.write(_jsp_string9, 0, _jsp_string9.length);
    out.print((i));
    out.write(_jsp_string10, 0, _jsp_string10.length);
    out.print((extend.getCName()));
    out.write(_jsp_string11, 0, _jsp_string11.length);
    out.print((extend.getEName()));
    out.write(_jsp_string12, 0, _jsp_string12.length);
    out.print((i));
    out.write(_jsp_string13, 0, _jsp_string13.length);
    if(controlType==0){
    out.write(_jsp_string14, 0, _jsp_string14.length);
    }
    out.write(_jsp_string15, 0, _jsp_string15.length);
    if(controlType==1){
    out.write(_jsp_string14, 0, _jsp_string14.length);
    }
    out.write(_jsp_string16, 0, _jsp_string16.length);
    if(controlType==2){
    out.write(_jsp_string14, 0, _jsp_string14.length);
    }
    out.write(_jsp_string17, 0, _jsp_string17.length);
    if(controlType==3){
    out.write(_jsp_string14, 0, _jsp_string14.length);
    }
    out.write(_jsp_string18, 0, _jsp_string18.length);
    if(controlType==4){
    out.write(_jsp_string14, 0, _jsp_string14.length);
    }
    out.write(_jsp_string19, 0, _jsp_string19.length);
    if(controlType==5){
    out.write(_jsp_string14, 0, _jsp_string14.length);
    }
    out.write(_jsp_string20, 0, _jsp_string20.length);
    if(controlType==6){
    out.write(_jsp_string14, 0, _jsp_string14.length);
    }
    out.write(_jsp_string21, 0, _jsp_string21.length);
    out.print((i));
    out.write(_jsp_string22, 0, _jsp_string22.length);
    if(dataType==1){
    out.write(_jsp_string14, 0, _jsp_string14.length);
    }
    out.write(_jsp_string23, 0, _jsp_string23.length);
    if(dataType==2){
    out.write(_jsp_string14, 0, _jsp_string14.length);
    }
    out.write(_jsp_string24, 0, _jsp_string24.length);
    if(dataType==3){
    out.write(_jsp_string14, 0, _jsp_string14.length);
    }
    out.write(_jsp_string25, 0, _jsp_string25.length);
    if(dataType==4){
    out.write(_jsp_string14, 0, _jsp_string14.length);
    }
    out.write(_jsp_string26, 0, _jsp_string26.length);
    if (controlType==5) {
    out.write(_jsp_string27, 0, _jsp_string27.length);
    out.print((i));
    out.write(_jsp_string28, 0, _jsp_string28.length);
    out.print(((extend.getDefaultValue()==null)?"":extend.getDefaultValue()));
    out.write(_jsp_string29, 0, _jsp_string29.length);
    out.print((i));
    out.write(_jsp_string30, 0, _jsp_string30.length);
    out.print((i));
    out.write(_jsp_string31, 0, _jsp_string31.length);
    out.print((i));
    out.write(_jsp_string32, 0, _jsp_string32.length);
    
                                        String tempbuf = extend.getDefaultValue();
                                        if (tempbuf!=null && tempbuf!="") {
                                            tempbuf = tempbuf.replaceAll("'","\"");
                                            JSONObject jsStr = JSONObject.fromObject(tempbuf);
                                            JSONArray jsonArray = jsStr.getJSONArray("data");
                                            List<zTreeNodeObj> zTreeNodeObjs = JSON_Str_To_ObjArray.Transfer_JsonStr_To_ObjArray(jsonArray);
                                            List typeOptions = JSON_Str_To_ObjArray.genOptionsStr(zTreeNodeObjs);
                                            tempbuf="";
                                            for (int ii=0;ii<typeOptions.size();ii++) {
                                                tempbuf = tempbuf + typeOptions.get(ii);
                                            }

                                            String[] ss = tempbuf.split("\r\n");
                                            for(int ii=0; ii<ss.length; ii++) {
                                                String tbuf = ss[ii];
                                                int posi = tbuf.indexOf("|");
                                                String text = tbuf.substring(0,posi);
                                                String value = tbuf.substring(posi+1);
                                                out.println("<option value=\"" + value + "\">" + text + "</option>");
                                            }
                                        }
                                    
    out.write(_jsp_string33, 0, _jsp_string33.length);
    } else {
    out.write(_jsp_string34, 0, _jsp_string34.length);
    }
    out.write(_jsp_string35, 0, _jsp_string35.length);
    out.print((extend.getEName()));
    out.write(_jsp_string36, 0, _jsp_string36.length);
    out.print((from));
    out.write(_jsp_string2, 0, _jsp_string2.length);
    out.print((columnID));
    out.write(_jsp_string37, 0, _jsp_string37.length);
    out.print((i));
    out.write(_jsp_string38, 0, _jsp_string38.length);
    out.print((extend.getEName()));
    out.write(_jsp_string39, 0, _jsp_string39.length);
    }}
    out.write(_jsp_string40, 0, _jsp_string40.length);
    out.print(((extattrscope==true)?1:0));
    out.write(_jsp_string41, 0, _jsp_string41.length);
    out.print(((extattrscope==true)?"checked":""));
    out.write(_jsp_string42, 0, _jsp_string42.length);
  }

  private com.caucho.make.DependencyContainer _caucho_depends
    = new com.caucho.make.DependencyContainer();

  public java.util.ArrayList<com.caucho.vfs.Dependency> _caucho_getDependList()
  {
    return _caucho_depends.getDependencies();
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    _caucho_depends.add(depend);
  }

  protected void _caucho_setNeverModified(boolean isNotModified)
  {
    _caucho_isNotModified = true;
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;

    if (_caucho_isNotModified)
      return false;

    if (com.caucho.server.util.CauchoSystem.getVersionId() != 6165118203484593848L)
      return true;

    return _caucho_depends.isModified();
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
    TagState tagState;
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("column/editattr.jsp"), 5054372349200564668L, false);
    _caucho_depends.add(depend);
    loader.addDependency(depend);
  }

  final static class TagState {

    void release()
    {
    }
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void caucho_init(ServletConfig config)
  {
    try {
      com.caucho.server.webapp.WebApp webApp
        = (com.caucho.server.webapp.WebApp) config.getServletContext();
      init(config);
      if (com.caucho.jsp.JspManager.getCheckInterval() >= 0)
        _caucho_depends.setCheckInterval(com.caucho.jsp.JspManager.getCheckInterval());
      _jsp_pageManager = webApp.getJspApplicationContext().getPageManager();
      com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
      com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.InitPageContextImpl(webApp, this);
    } catch (Exception e) {
      throw com.caucho.config.ConfigException.create(e);
    }
  }

  private final static char []_jsp_string17;
  private final static char []_jsp_string27;
  private final static char []_jsp_string13;
  private final static char []_jsp_string22;
  private final static char []_jsp_string34;
  private final static char []_jsp_string12;
  private final static char []_jsp_string1;
  private final static char []_jsp_string41;
  private final static char []_jsp_string39;
  private final static char []_jsp_string8;
  private final static char []_jsp_string35;
  private final static char []_jsp_string20;
  private final static char []_jsp_string36;
  private final static char []_jsp_string11;
  private final static char []_jsp_string6;
  private final static char []_jsp_string37;
  private final static char []_jsp_string19;
  private final static char []_jsp_string18;
  private final static char []_jsp_string3;
  private final static char []_jsp_string10;
  private final static char []_jsp_string14;
  private final static char []_jsp_string2;
  private final static char []_jsp_string42;
  private final static char []_jsp_string5;
  private final static char []_jsp_string28;
  private final static char []_jsp_string4;
  private final static char []_jsp_string7;
  private final static char []_jsp_string15;
  private final static char []_jsp_string33;
  private final static char []_jsp_string29;
  private final static char []_jsp_string30;
  private final static char []_jsp_string0;
  private final static char []_jsp_string24;
  private final static char []_jsp_string31;
  private final static char []_jsp_string32;
  private final static char []_jsp_string40;
  private final static char []_jsp_string16;
  private final static char []_jsp_string38;
  private final static char []_jsp_string25;
  private final static char []_jsp_string21;
  private final static char []_jsp_string9;
  private final static char []_jsp_string26;
  private final static char []_jsp_string23;
  static {
    _jsp_string17 = ">\u6eda\u52a8\u6587\u672c\u6846</option>\r\n                            <option value=\"3\" ".toCharArray();
    _jsp_string27 = "\r\n                        <td>\r\n                            <input type=\"hidden\" name=\"droplist".toCharArray();
    _jsp_string13 = "\" class=tine style=\"width:90px\">\r\n                            <option value=\"0\" ".toCharArray();
    _jsp_string22 = "\" class=tine style=\"width:75px\">\r\n                            <option value=\"1\" ".toCharArray();
    _jsp_string34 = "\r\n                        <td>&nbsp;</td>\r\n                        ".toCharArray();
    _jsp_string12 = "</td>\r\n                        <td align=\"center\"><select size=\"1\" name=\"type".toCharArray();
    _jsp_string1 = "\r\n\r\n<html>\r\n<head>\r\n    <title>\u6269\u5c55\u5c5e\u6027</title>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\">\r\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../style/global.css\">\r\n    <script type=\"text/javascript\" src=\"../js/jquery-1.11.1.min.js\"></script>\r\n    <script type=\"text/javascript\" src=\"../js/json2.js\"></script>\r\n    <script language=javascript>\r\n        function check(frm) {\r\n            var src=document.activeElement;\r\n            var val = src.value;\r\n            if (val==\"  \u63d0\u4ea4  \" && frm.cname.value == \"\") {\r\n                alert(\"\u6269\u5c55\u5c5e\u6027\u4e2d\u6587\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01\");\r\n                return false;\r\n                cname.focus();\r\n            }\r\n            if (val==\"  \u63d0\u4ea4  \" && frm.ename.value == \"\") {\r\n                alert(\"\u6269\u5c55\u5c5e\u6027\u82f1\u6587\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01\");\r\n                return false;\r\n                ename.focus();\r\n            }\r\n            if (val==\"  \u63d0\u4ea4  \" && !checkEname(frm.ename.value)) {\r\n                alert(\"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u82f1\u6587\u540d\u79f0\uff01\");\r\n                return false;\r\n                ename.focus();\r\n            }\r\n\r\n            if (val==\"   \u4fdd\u5b58   \"){\r\n                frm.act.value = \"doSave\";\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        function checkEname(ename) {\r\n            var retstr = false;\r\n            var regstr = /[^a-zA-Z0-9_]/gi;\r\n            if (regstr.exec(ename) == null) {\r\n                retstr = true;\r\n            }\r\n            return retstr;\r\n        }\r\n\r\n        function Update(i,ename) {\r\n            var cname = document.all(\"cname\"+i).value;\r\n            if (cname == \"\") return;\r\n            var type = document.all(\"type\"+i).value;\r\n            var datatype = document.all(\"datatype\"+i).value;\r\n            if (type != 5)\r\n                window.location = \"editattr.jsp?ename=\"+ename+\"&cname=\"+cname+\"&type=\"+type+\"&datatype=\"+datatype+\"&act=doUpdate&from=".toCharArray();
    _jsp_string41 = "\" ".toCharArray();
    _jsp_string39 = "');\">\u4fee\u6539</a>\r\n                        </td>\r\n                    </tr>\r\n                    ".toCharArray();
    _jsp_string8 = "</td></tr>\r\n        <tr height=80>\r\n            <td width=\"100%\">\r\n                <input type=\"hidden\" name=\"act\" value=\"doCreate\">\r\n                <input type=\"hidden\" name=\"defaultval\" value=\"\">\r\n                <input type=\"hidden\" name=\"rowno\" value=\"\">\r\n                <input type=\"hidden\" name=\"droplist\" value=\"\">\r\n                <table border=0 cellspacing=2 cellpadding=2 width=\"100%\">\r\n                    <tr>\r\n                        <td width=\"60%\">\r\n                            \u4e2d\u6587\u540d\u79f0\uff1a<input name=\"cname\" size=\"15\" class=tine>\r\n                            \u82f1\u6587\u540d\u79f0\uff1a<input name=\"ename\" size=\"15\" class=tine></td>\r\n                        <td width=\"40%\"><div style=\"display:none\" id=picattr>\r\n                            <b>\u5bbd</b>\uff1a<input name=\"width\" size=\"4\" class=tine>\r\n                            <b>\u9ad8</b>\uff1a<input name=\"height\" size=\"4\" class=tine></div></td></tr>\r\n                    <tr>\r\n                        <td>\r\n                            \u63a7\u4ef6\u7c7b\u578b\uff1a<select size=\"1\" name=\"type\" id=\"typeid\" class=tine style=\"width:102px\" onchange=\"control();\">\r\n                            <option value=\"0\">\u8bf7\u9009\u62e9</option>\r\n                            <option value=\"1\">\u5355\u884c\u6587\u672c\u6846</option>\r\n                            <option value=\"2\">\u6eda\u52a8\u6587\u672c\u6846</option>\r\n                            <option value=\"3\">\u6587\u4ef6\u4e0a\u4f20</option>\r\n                            <option value=\"4\">HTML\u7f16\u8f91\u5668</option>\r\n                            <option value=\"5\">\u4e0b\u62c9\u5217\u8868</option>\r\n                            <option value=\"6\">\u65e5\u671f\u4e0e\u65f6\u95f4</option>\r\n                        </select>\r\n                            \u6570\u636e\u7c7b\u578b\uff1a<select size=\"1\" name=\"datatype\" class=tine style=\"width:102px\">\r\n                            <option value=\"1\">\u5b57\u7b26\u578b</option>\r\n                            <option value=\"2\">\u6574\u6570\u578b</option>\r\n                            <option value=\"3\">\u6587\u672c\u578b</option>\r\n                            <option value=\"4\">\u5c0f\u6570\u578b</option>\r\n                        </select></td>\r\n                        <td><input type=\"submit\" value=\"  \u63d0\u4ea4  \" name=\"submit\" class=tine></td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td width=\"100%\">\r\n                <table border=1 borderColorDark=#ffffec borderColorLight=#5e5e00 cellPadding=0 cellSpacing=0 width=\"100%\">\r\n                    <tr>\r\n                        <td width=\"20%\" align=\"center\"><B>\u4e2d\u6587\u540d\u79f0</B></td>\r\n                        <td width=\"15%\" align=\"center\"><B>\u82f1\u6587\u540d\u79f0</B></td>\r\n                        <td width=\"10%\" align=\"center\"><B>\u63a7\u4ef6\u7c7b\u578b</B></td>\r\n                        <td width=\"10%\" align=\"center\"><B>\u6570\u636e\u7c7b\u578b</B></td>\r\n                        <td width=\"15%\" align=\"center\"><B>\u9ed8\u8ba4\u503c</B></td>\r\n                        <td width=\"10%\" align=\"center\"><B>\u5355\u4f4d</B></td>\r\n                        <td width=\"10%\" align=\"center\"><B>\u53ef\u5426\u4e3a\u7a7a</B></td>\r\n                        <td width=\"10%\" align=\"center\"><B>\u64cd\u4f5c</B></td>\r\n                    </tr>\r\n                    ".toCharArray();
    _jsp_string35 = "\r\n                        <td align=\"center\"><input type=\"text\" name=\"unit\" size=\"5\"></td>\r\n                        <td align=\"center\"><input type=\"checkbox\" name=\"allownull\">\u7a7a</td>\r\n                        <td align=\"center\">\r\n                            <a href=\"editattr.jsp?ename=".toCharArray();
    _jsp_string20 = ">\u4e0b\u62c9\u5217\u8868</option>\r\n                            <option value=\"6\" ".toCharArray();
    _jsp_string36 = "&act=doDelete&from=".toCharArray();
    _jsp_string11 = "\" class=tine></td>\r\n                        <td align=\"center\">".toCharArray();
    _jsp_string6 = "&act=add&rowno=0\", \"\", 'width=800,height=650,left=200,top=50,scrollbars=yes');\r\n            }\r\n        }\r\n\r\n        function setSelectOptions(rowno) {\r\n            var content = eval(\"document.attr.droplist\" + rowno).value;\r\n            var opts = new Array();\r\n            opts = content.split(\"\\r\\n\");\r\n            var mysel = document.getElementById(\"selid\" + rowno);\r\n            mysel.options.length=0;\r\n            for(i=0;i<opts.length;i++){\r\n                posi = opts[i].indexOf(\"|\");\r\n                key = opts[i].substring(0,posi);\r\n                value = opts[i].substring(posi+1);\r\n                var varItem = new Option(key,value);\r\n                mysel.options.add(varItem);\r\n            }\r\n        }\r\n    </script>\r\n</head>\r\n\r\n<body>\r\n<form name=\"attr\" method=\"POST\" action=\"editattr.jsp?from=".toCharArray();
    _jsp_string37 = "\">\u5220\u9664</a>&nbsp;\r\n                            <a href=\"javascript:Update(".toCharArray();
    _jsp_string19 = ">HTML\u7f16\u8f91\u5668</option>\r\n                            <option value=\"5\" ".toCharArray();
    _jsp_string18 = ">\u6587\u4ef6\u4e0a\u4f20</option>\r\n                            <option value=\"4\" ".toCharArray();
    _jsp_string3 = "\";\r\n            else {\r\n                attr.cname.value = cname;\r\n                attr.ename.value = ename;\r\n                attr.act.value = \"update\";\r\n                attr.rowno.value = i;\r\n                window.open(\"editattrfordroplist.jsp?ename=\" + ename + \"&cname=\"+cname+\"&type=\"+type+\"&datatype=\"+datatype+\"&from=".toCharArray();
    _jsp_string10 = " value=\"".toCharArray();
    _jsp_string14 = "selected".toCharArray();
    _jsp_string2 = "&ID=".toCharArray();
    _jsp_string42 = ">\u9002\u7528\u672c\u680f\u76ee\u4e0b\u6240\u6709\u5546\u54c1\u680f\u76ee\r\n                <input type=\"submit\" value=\"   \u4fdd\u5b58   \" name=\"save\" class=tine>&nbsp;&nbsp;\r\n                <input type=\"button\" value=\"   \u5173\u95ed   \" name=\"close\" class=tine onclick=\"window.close();\">\r\n            </td>\r\n        </tr>\r\n        <tr><td><font color=\"red\"><b>\u6ce8\u610f\uff1a\u8bf7\u70b9\u51fb\u201c\u4fdd\u5b58\u201d\u6309\u94ae\uff0c\u4e0d\u8981\u76f4\u63a5\u5173\u95ed\uff01</b></font></td></tr>\r\n    </table>\r\n</form>\r\n</body>\r\n</html>".toCharArray();
    _jsp_string5 = "&act=update&rowno=\" + i, \"\", 'width=800,height=650,left=200,top=50,scrollbars=yes');\r\n            }\r\n        }\r\n\r\n        function control() {\r\n            if (document.all(\"type\").value == \"3\")\r\n                picattr.style.display = \"\";\r\n            else\r\n                picattr.style.display = \"none\";\r\n            if (document.all(\"type\").value == \"5\") {\r\n                window.open(\"editattrfordroplist.jsp?column=".toCharArray();
    _jsp_string28 = "\" value=\"".toCharArray();
    _jsp_string4 = "&column=".toCharArray();
    _jsp_string7 = "\" onsubmit=\"javascript:return check(this);\">\r\n    <table border=\"0\" width=\"100%\" align=\"center\">\r\n        <tr><td>".toCharArray();
    _jsp_string15 = ">\u8bf7\u9009\u62e9</option>\r\n                            <option value=\"1\" ".toCharArray();
    _jsp_string33 = "\r\n                                </select>\r\n                            </div>\r\n                        </td>\r\n                        ".toCharArray();
    _jsp_string29 = "\">\r\n                            <div id=\"dl".toCharArray();
    _jsp_string30 = "\" style=\"display: block\">\r\n                                <select size=\"1\" id=\"selid".toCharArray();
    _jsp_string0 = "\r\n\r\n\r\n\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string24 = ">\u6574\u6570\u578b</option>\r\n                            <option value=\"3\" ".toCharArray();
    _jsp_string31 = "\" name=\"selname".toCharArray();
    _jsp_string32 = "\"  class=\"tine\" style=\"width:75px\">\r\n                                    ".toCharArray();
    _jsp_string40 = "\r\n                </table>\r\n            </td>\r\n        </tr>\r\n\r\n        <tr height=40>\r\n            <td align=left>\r\n                <input type=\"checkbox\" name=\"attrscope\" id=\"attrscopeid\" value=\"".toCharArray();
    _jsp_string16 = ">\u5355\u884c\u6587\u672c\u6846</option>\r\n                            <option value=\"2\" ".toCharArray();
    _jsp_string38 = ",'".toCharArray();
    _jsp_string25 = ">\u6587\u672c\u578b</option>\r\n                            <option value=\"4\" ".toCharArray();
    _jsp_string21 = ">\u65e5\u671f\u4e0e\u65f6\u95f4</option>\r\n                        </select></td>\r\n                        <td align=\"center\"><select size=\"1\" name=\"datatype".toCharArray();
    _jsp_string9 = "\r\n                    <tr height=26>\r\n                        <td align=\"center\"><input name=cname".toCharArray();
    _jsp_string26 = ">\u5c0f\u6570\u578b</option>\r\n                        </select></td>\r\n                        <!--\u8bbe\u7f6e\u5c5e\u7684\u9ed8\u8ba4\u503c-->\r\n                        ".toCharArray();
    _jsp_string23 = ">\u5b57\u7b26\u578b</option>\r\n                            <option value=\"2\" ".toCharArray();
  }
}
